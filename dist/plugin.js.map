{"version":3,"file":"plugin.js","sources":["esm/definitions.js","esm/index.js","esm/web.js"],"sourcesContent":["export var RecordingError;\n(function (RecordingError) {\n    RecordingError[\"NOT_RECORDING\"] = \"NOT_RECORDING\";\n    RecordingError[\"DEVICE_NOT_SUPPORTED\"] = \"DEVICE_NOT_SUPPORTED\";\n    RecordingError[\"MISSING_MICROPHONE_PERMISSION\"] = \"MISSING_MICROPHONE_PERMISSION\";\n    RecordingError[\"MICROPHONE_IN_USE\"] = \"MICROPHONE_IN_USE\";\n    RecordingError[\"UNKNOWN_ERROR\"] = \"UNKNOWN_ERROR\";\n})(RecordingError || (RecordingError = {}));\n//# sourceMappingURL=definitions.js.map","import { registerPlugin } from '@capacitor/core';\nconst CapacitorVoiceRecorder = registerPlugin('CapacitorVoiceRecorder', {\n    web: () => import('./web').then((m) => new m.CapacitorVoiceRecorderWeb()),\n});\nexport * from './definitions';\nexport { CapacitorVoiceRecorder };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nimport { deregister, MediaRecorder, register } from 'extendable-media-recorder';\nimport { connect, disconnect } from 'extendable-media-recorder-wav-encoder';\nimport { RecordingError } from './definitions';\nexport class CapacitorVoiceRecorderWeb extends WebPlugin {\n    constructor() {\n        super();\n        this.mimeType = 'audio/wav';\n        this._chunks = [];\n    }\n    async canRecord() {\n        var _a;\n        if (!((_a = navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia)) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        return navigator.permissions.query({ name: 'microphone' }).then((result) => {\n            if (result.state === 'granted') {\n                return { status: 'GRANTED' };\n            }\n            else {\n                return { status: 'NOT_GRANTED' };\n            }\n        });\n    }\n    async requestPermission() {\n        var _a;\n        if (!((_a = navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia)) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        const hasPermission = await this.canRecord();\n        if (hasPermission.status === 'GRANTED') {\n            return { isGranted: true };\n        }\n        try {\n            return navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n                stream.getTracks().forEach((track) => track.stop());\n                return { isGranted: true };\n            });\n        }\n        catch (error) {\n            return Promise.reject(RecordingError.MISSING_MICROPHONE_PERMISSION);\n        }\n    }\n    async startRecording() {\n        if (this._mediaRecorder != null) {\n            return Promise.reject(RecordingError.MICROPHONE_IN_USE);\n        }\n        const hasPermission = await this.canRecord();\n        if (!hasPermission) {\n            return Promise.reject(RecordingError.MISSING_MICROPHONE_PERMISSION);\n        }\n        this._encoder = await connect();\n        await register(this._encoder);\n        this._mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        this._mediaRecorder = new MediaRecorder(this._mediaStream, { mimeType: 'audio/wav' });\n        this._mediaRecorder.onstart = () => {\n            this._startedRecordingAt = new Date();\n        };\n        const audioContext = new AudioContext();\n        const analyser = audioContext.createAnalyser();\n        analyser.fftSize = 8192;\n        analyser.minDecibels = -90;\n        analyser.maxDecibels = -10;\n        analyser.smoothingTimeConstant = 0;\n        const dataArray = new Uint8Array(analyser.fftSize);\n        const source = audioContext.createMediaStreamSource(this._mediaStream);\n        source.connect(analyser);\n        this._mediaRecorder.ondataavailable = async (event) => {\n            this._chunks.push(event.data);\n            analyser.getByteFrequencyData(dataArray);\n            const frequencies = btoa(String.fromCharCode.apply(null, Array.from(dataArray).splice(0, analyser.fftSize)));\n            this.notifyListeners('frequencyData', { base64: frequencies });\n        };\n        this._mediaRecorder.onerror = () => {\n            if (!this._mediaRecorder) {\n                return Promise.reject(RecordingError.NOT_RECORDING);\n            }\n            this._mediaRecorder.stop();\n            this._prepareInstanceForNextOperation();\n            this._startedRecordingAt = undefined;\n            this._mediaStream = undefined;\n            this._mediaRecorder = undefined;\n            this._chunks = [];\n            return Promise.reject(RecordingError.UNKNOWN_ERROR);\n        };\n        this._mediaRecorder.start(100);\n    }\n    async stopRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        const mimeType = this.mimeType;\n        if (mimeType == null) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        this._prepareInstanceForNextOperation();\n        const blobVoiceRecording = new Blob(this._chunks, { type: mimeType });\n        const recordingDuration = new Date().getTime() - this._startedRecordingAt.getTime();\n        this._startedRecordingAt = undefined;\n        this._mediaStream = undefined;\n        this._mediaRecorder = undefined;\n        this._chunks = [];\n        await deregister(this._encoder);\n        await disconnect(this._encoder);\n        this._encoder = undefined;\n        return {\n            base64: await this._blobToBase64(blobVoiceRecording),\n            msDuration: recordingDuration,\n            size: blobVoiceRecording.size,\n        };\n    }\n    async pauseRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        if (this._mediaRecorder.state === 'recording') {\n            this._mediaRecorder.pause();\n            return;\n        }\n        return Promise.reject(RecordingError.NOT_RECORDING);\n    }\n    async resumeRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        if (this._mediaRecorder.state === 'paused') {\n            this._mediaRecorder.resume();\n            return;\n        }\n        return Promise.reject(RecordingError.NOT_RECORDING);\n    }\n    async getCurrentStatus() {\n        if (!this._mediaRecorder) {\n            return Promise.resolve({ status: 'NOT_RECORDING' });\n        }\n        if (this._mediaRecorder.state === 'recording') {\n            return Promise.resolve({ status: 'RECORDING' });\n        }\n        else if (this._mediaRecorder.state === 'paused') {\n            return Promise.resolve({ status: 'PAUSED' });\n        }\n        else {\n            return Promise.resolve({ status: 'NOT_RECORDING' });\n        }\n    }\n    _prepareInstanceForNextOperation() {\n        if (this._mediaRecorder != null && this._mediaRecorder.state === 'recording') {\n            try {\n                this._mediaRecorder.stop();\n                this._mediaStream.getTracks().forEach((track) => track.stop());\n            }\n            catch (error) {\n                console.warn('While trying to stop a media recorder, an error was thrown', error);\n            }\n        }\n    }\n    async _blobToBase64(blob) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => {\n                const dataUrl = reader.result;\n                const base64Data = dataUrl.split(',')[1]; // Extract base64 part\n                resolve(base64Data);\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["RecordingError","registerPlugin","WebPlugin","connect","register","MediaRecorder","deregister","disconnect"],"mappings":"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"}