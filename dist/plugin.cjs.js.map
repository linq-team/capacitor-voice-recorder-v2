{"version":3,"file":"plugin.cjs.js","sources":["esm/definitions.js","esm/index.js","esm/web.js"],"sourcesContent":["export var RecordingError;\n(function (RecordingError) {\n    RecordingError[\"NOT_RECORDING\"] = \"NOT_RECORDING\";\n    RecordingError[\"DEVICE_NOT_SUPPORTED\"] = \"DEVICE_NOT_SUPPORTED\";\n    RecordingError[\"MISSING_MICROPHONE_PERMISSION\"] = \"MISSING_MICROPHONE_PERMISSION\";\n    RecordingError[\"MICROPHONE_IN_USE\"] = \"MICROPHONE_IN_USE\";\n    RecordingError[\"UNKNOWN_ERROR\"] = \"UNKNOWN_ERROR\";\n})(RecordingError || (RecordingError = {}));\n//# sourceMappingURL=definitions.js.map","import { registerPlugin } from '@capacitor/core';\nconst CapacitorVoiceRecorder = registerPlugin('CapacitorVoiceRecorder', {\n    web: () => import('./web').then((m) => new m.CapacitorVoiceRecorderWeb()),\n});\nexport * from './definitions';\nexport { CapacitorVoiceRecorder };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nimport { deregister, MediaRecorder, register } from 'extendable-media-recorder';\nimport { connect, disconnect } from 'extendable-media-recorder-wav-encoder';\nimport { RecordingError } from './definitions';\nexport class CapacitorVoiceRecorderWeb extends WebPlugin {\n    constructor() {\n        super();\n        this.mimeType = 'audio/wav';\n        this._chunks = [];\n    }\n    async canRecord() {\n        var _a;\n        if (!((_a = navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia)) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        return navigator.permissions.query({ name: 'microphone' }).then((result) => {\n            if (result.state === 'granted') {\n                return { status: 'GRANTED' };\n            }\n            else {\n                return { status: 'NOT_GRANTED' };\n            }\n        });\n    }\n    async requestPermission() {\n        var _a;\n        if (!((_a = navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia)) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        const hasPermission = await this.canRecord();\n        if (hasPermission) {\n            return { isGranted: true };\n        }\n        try {\n            return navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n                stream.getTracks().forEach((track) => track.stop());\n                return { isGranted: true };\n            });\n        }\n        catch (error) {\n            return Promise.reject(RecordingError.MISSING_MICROPHONE_PERMISSION);\n        }\n    }\n    async startRecording() {\n        if (this._mediaRecorder != null) {\n            return Promise.reject(RecordingError.MICROPHONE_IN_USE);\n        }\n        const hasPermission = await this.canRecord();\n        if (!hasPermission) {\n            return Promise.reject(RecordingError.MISSING_MICROPHONE_PERMISSION);\n        }\n        this._encoder = await connect();\n        await register(this._encoder);\n        this._mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        this._mediaRecorder = new MediaRecorder(this._mediaStream, { mimeType: 'audio/wav' });\n        this._mediaRecorder.onstart = () => {\n            this._startedRecordingAt = new Date();\n        };\n        const audioContext = new AudioContext();\n        const analyser = audioContext.createAnalyser();\n        analyser.fftSize = 8192;\n        analyser.minDecibels = -90;\n        analyser.maxDecibels = -10;\n        analyser.smoothingTimeConstant = 0;\n        const dataArray = new Uint8Array(analyser.fftSize);\n        const source = audioContext.createMediaStreamSource(this._mediaStream);\n        source.connect(analyser);\n        this._mediaRecorder.ondataavailable = async (event) => {\n            this._chunks.push(event.data);\n            analyser.getByteFrequencyData(dataArray);\n            const frequencies = btoa(String.fromCharCode.apply(null, Array.from(dataArray).splice(0, analyser.fftSize)));\n            this.notifyListeners('frequencyData', { base64: frequencies });\n        };\n        this._mediaRecorder.onerror = () => {\n            if (!this._mediaRecorder) {\n                return Promise.reject(RecordingError.NOT_RECORDING);\n            }\n            this._mediaRecorder.stop();\n            this._prepareInstanceForNextOperation();\n            this._startedRecordingAt = undefined;\n            this._mediaStream = undefined;\n            this._mediaRecorder = undefined;\n            this._chunks = [];\n            return Promise.reject(RecordingError.UNKNOWN_ERROR);\n        };\n        this._mediaRecorder.start(100);\n    }\n    async stopRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        const mimeType = this.mimeType;\n        if (mimeType == null) {\n            return Promise.reject(RecordingError.DEVICE_NOT_SUPPORTED);\n        }\n        this._prepareInstanceForNextOperation();\n        const blobVoiceRecording = new Blob(this._chunks, { type: mimeType });\n        const recordingDuration = new Date().getTime() - this._startedRecordingAt.getTime();\n        this._startedRecordingAt = undefined;\n        this._mediaStream = undefined;\n        this._mediaRecorder = undefined;\n        this._chunks = [];\n        await deregister(this._encoder);\n        await disconnect(this._encoder);\n        this._encoder = undefined;\n        return {\n            base64: await this._blobToBase64(blobVoiceRecording),\n            msDuration: recordingDuration,\n            size: blobVoiceRecording.size,\n        };\n    }\n    async pauseRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        if (this._mediaRecorder.state === 'recording') {\n            this._mediaRecorder.pause();\n            return;\n        }\n        return Promise.reject(RecordingError.NOT_RECORDING);\n    }\n    async resumeRecording() {\n        if (!this._mediaRecorder) {\n            return Promise.reject(RecordingError.NOT_RECORDING);\n        }\n        if (this._mediaRecorder.state === 'paused') {\n            this._mediaRecorder.resume();\n            return;\n        }\n        return Promise.reject(RecordingError.NOT_RECORDING);\n    }\n    async getCurrentStatus() {\n        if (!this._mediaRecorder) {\n            return Promise.resolve({ status: 'NOT_RECORDING' });\n        }\n        if (this._mediaRecorder.state === 'recording') {\n            return Promise.resolve({ status: 'RECORDING' });\n        }\n        else if (this._mediaRecorder.state === 'paused') {\n            return Promise.resolve({ status: 'PAUSED' });\n        }\n        else {\n            return Promise.resolve({ status: 'NOT_RECORDING' });\n        }\n    }\n    _prepareInstanceForNextOperation() {\n        if (this._mediaRecorder != null && this._mediaRecorder.state === 'recording') {\n            try {\n                this._mediaRecorder.stop();\n                this._mediaStream.getTracks().forEach((track) => track.stop());\n            }\n            catch (error) {\n                console.warn('While trying to stop a media recorder, an error was thrown', error);\n            }\n        }\n    }\n    async _blobToBase64(blob) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => {\n                const dataUrl = reader.result;\n                const base64Data = dataUrl.split(',')[1]; // Extract base64 part\n                resolve(base64Data);\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["RecordingError","registerPlugin","WebPlugin","connect","register","MediaRecorder","deregister","disconnect"],"mappings":"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"}